<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Godot Iframe Test Parent</title>
    <style>
      body { background: #222; color: #fff; }
      iframe { border: 2px solid #09f; }
      #manaLabel { font-weight: bold; margin-left: 1em; }
    </style>
</head>
<body>
    <h2>Mockup Parent - Godot Iframe Integration</h2>
<iframe id="gameframe" src="game/index.html" width="900" height="600"></iframe>
<script>
  let mana = 1000;
  const manaLabel = document.getElementById('manaLabel');

  window.addEventListener('message', (event) => {
    const data = event.data || {};
    if (data.type === 'requestMana') {
      const ok = mana >= data.amount;
      if (ok) mana -= data.amount;
      event.source.postMessage({ type: 'manaUpdated', approved: ok, mana }, '*');
      manaLabel.textContent = 'Mana: ' + mana;
    }
    if (data.type === 'getMana') {
      event.source.postMessage({ type: 'updateMana', mana }, '*');
    }
  });

  function addMana() {
    mana += 100;
    manaLabel.textContent = 'Mana: ' + mana;
    // push เข้ากรอบเกมทันที
    document.getElementById('gameframe')
      .contentWindow.postMessage({ type: 'updateMana', mana }, '*');
  }
</script>
</body>
</html>