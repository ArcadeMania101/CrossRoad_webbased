<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Godot Iframe Test Parent</title>
    <style>
      body { background: #222; color: #fff; }
      iframe { border: 2px solid #09f; }
      #manaLabel { font-weight: bold; margin-left: 1em; }
    </style>
</head>
<body>
    <h2>Mockup Parent - Godot Iframe Integration</h2>
    <iframe id="gameframe" src="game/index.html" width="900" height="600"></iframe>
    <div style="margin-top:20px;">
        <button onclick="addMana()">เติม Mana</button>
        <span id="manaLabel"></span>
    </div>

    <script>
      let mana = 1000;
      const manaLabel = document.getElementById('manaLabel');
      manaLabel.innerText = 'Mana: ' + mana;

      // ฟัง event จาก iframe
      window.addEventListener('message', function(event) {
        // --- Production Safety! ---
        // เช็ค origin ก่อนตอบกลับ (ตัวอย่าง: event.origin === "https://yourgame.com")
        // if (event.origin !== "http://localhost:8000") return;

        if (event.data && event.data.type === 'requestMana') {
          let amount = event.data.amount;
          if (mana >= amount) {
            mana -= amount;
            event.source.postMessage(
              { type: 'manaUpdated', approved: true, mana: mana },
              '*' // สำหรับ production ให้ใช้ origin แทน '*'
            );
          } else {
            event.source.postMessage(
              { type: 'manaUpdated', approved: false, mana: mana },
              '*'
            );
          }
          manaLabel.innerText = 'Mana: ' + mana;
        }
        // สำหรับให้ iframe ขอ sync ค่าปัจจุบัน (optional)
        if (event.data && event.data.type === 'getMana') {
          event.source.postMessage({ type: 'updateMana', mana: mana }, '*');
        }
      });

      // ปุ่มเติม mana
      function addMana() {
        mana += 100;
        manaLabel.innerText = 'Mana: ' + mana;
      }
    </script>
</body>
</html>